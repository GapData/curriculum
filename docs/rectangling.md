---
title: Data rectangling
---

<!-- Generated automatically from rectangling.yml. Do not edit by hand -->

# Data rectangling <small class='explore'>[explore]</small>
<small>(Builds on: [List columns](list-cols.md))</small>


Data rectangling is the process of turning non-rectangular data into tidy tibbles. The term was [coined by](https://speakerdeck.com/jennybc/data-rectangling) by [Jenny Bryan](https://www.stat.ubc.ca/~jenny/). Here we're going to focus on deeply nested lists as generated by JSON, a very common data type for web APIs.

To work with JSON we need the jsonlite package, which I recommend loading before the tidyverse. (Both purrr and jsonlite provide a flatten function; if you load jsonlite second, you'll get that function instead of the one from purrr.)

``` r
library(jsonlite)
library(tidyverse)
library(repurrrsive)
```

We're going to use some data from Jenny's repurrrsive package, which you'll need to install from GitHub. We'll also use the GitHub version of purrr which fixes some bugs that will make your life easier.

``` r
# install.packages("devtools")
devtools::install_github("jennybc/repurrrsive")
devtools::install_github("tidyverse/purrr")
```

JSON
----

JSON is a popular data exchange format that made up of three simple components:

-   **Values**, like numbers, `true`, `false`, and strings inside double quotes.

    ``` json
    true
    1.345
    "this is a string"
    ```

-   **Arrays**, sequences of values surrounded in square brackets. JSON arrays are like R's lists: you can have anything inside an array including other arrays.

    ``` json
    [1, 2, 3, 10, 120]
    ["this", "is", "a", "string"]
    ["can arrays mix types?", true, 100]
    ```

-   **Objects**, name value pairs separated by colons. Objects are like named lists.

    ``` json
    {
      "key": "value",
      "name": "Hadley",
      "company": "RStudio"
    }
    ```

Arrays and objects can be nested in arbitrarily: it's common to have arrays of objects, and objects with array values. When working with JSON data typically your first problem is to figure out what the structure looks like.

You can load a json file into R with `jsonlite::read_json()`.

Inspect
-------

We're going to work with data about some GitHub repositories in `repurrrsive::github_repos`. The first challenge is just figuring out what this data looks like. Hopefully your first instinct is to try `str()`. This is a great instinct, but it's not very helpful here because it prints pages and pages of output. Another option, if you're willing to live (a little) dangerously, is to use a [daily build](https://dailies.rstudio.com) of RStudio which has a good interactive explorer that you can activate with:

``` r
View(github_repos)
```

Otherwise, you can use a powerful and general technique: understand the list by peeling it apart one layer at a time. To do that you need to first figure out if you an array (an unnamed list, which you should subset with an integer), or an object (a named list which you should subset with a string). You can figure that our using `names()`:

``` r
names(gh_repos)
#> NULL
length(gh_repos)
#> [1] 6
```

Here names is `NULL`, so we have an array and should subset by position:

``` r
one <- gh_repos[[1]]
```

It's worth trying `str()` again, but unfortunately this object is *still* too complicated. Let's index into it again:

``` r
names(one)
#> NULL
length(one)
#> [1] 30

# No names, so we can index by position
one_one <- one[[1]]
```

Let's try `str()` once more:

``` r
str(one_one)
#> List of 68
#>  $ id               : int 61160198
#>  $ name             : chr "after"
#>  $ full_name        : chr "gaborcsardi/after"
#>  $ owner            :List of 17
#>   ..$ login              : chr "gaborcsardi"
#>   ..$ id                 : int 660288
#>   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/660288?v=3"
#>   ..$ gravatar_id        : chr ""
#>   ..$ url                : chr "https://api.github.com/users/gaborcsardi"
#>   ..$ html_url           : chr "https://github.com/gaborcsardi"
#>   ..$ followers_url      : chr "https://api.github.com/users/gaborcsardi/followers"
#>   ..$ following_url      : chr "https://api.github.com/users/gaborcsardi/following{/other_user}"
#>   ..$ gists_url          : chr "https://api.github.com/users/gaborcsardi/gists{/gist_id}"
#>   ..$ starred_url        : chr "https://api.github.com/users/gaborcsardi/starred{/owner}{/repo}"
#>   ..$ subscriptions_url  : chr "https://api.github.com/users/gaborcsardi/subscriptions"
#>   ..$ organizations_url  : chr "https://api.github.com/users/gaborcsardi/orgs"
#>   ..$ repos_url          : chr "https://api.github.com/users/gaborcsardi/repos"
#>   ..$ events_url         : chr "https://api.github.com/users/gaborcsardi/events{/privacy}"
#>   ..$ received_events_url: chr "https://api.github.com/users/gaborcsardi/received_events"
#>   ..$ type               : chr "User"
#>   ..$ site_admin         : logi FALSE
#>  $ private          : logi FALSE
#>  $ html_url         : chr "https://github.com/gaborcsardi/after"
#>  $ description      : chr "Run Code in the Background"
#>  $ fork             : logi FALSE
#>  $ url              : chr "https://api.github.com/repos/gaborcsardi/after"
#>  $ forks_url        : chr "https://api.github.com/repos/gaborcsardi/after/forks"
#>  $ keys_url         : chr "https://api.github.com/repos/gaborcsardi/after/keys{/key_id}"
#>  $ collaborators_url: chr "https://api.github.com/repos/gaborcsardi/after/collaborators{/collaborator}"
#>  $ teams_url        : chr "https://api.github.com/repos/gaborcsardi/after/teams"
#>  $ hooks_url        : chr "https://api.github.com/repos/gaborcsardi/after/hooks"
#>  $ issue_events_url : chr "https://api.github.com/repos/gaborcsardi/after/issues/events{/number}"
#>  $ events_url       : chr "https://api.github.com/repos/gaborcsardi/after/events"
#>  $ assignees_url    : chr "https://api.github.com/repos/gaborcsardi/after/assignees{/user}"
#>  $ branches_url     : chr "https://api.github.com/repos/gaborcsardi/after/branches{/branch}"
#>  $ tags_url         : chr "https://api.github.com/repos/gaborcsardi/after/tags"
#>  $ blobs_url        : chr "https://api.github.com/repos/gaborcsardi/after/git/blobs{/sha}"
#>  $ git_tags_url     : chr "https://api.github.com/repos/gaborcsardi/after/git/tags{/sha}"
#>  $ git_refs_url     : chr "https://api.github.com/repos/gaborcsardi/after/git/refs{/sha}"
#>  $ trees_url        : chr "https://api.github.com/repos/gaborcsardi/after/git/trees{/sha}"
#>  $ statuses_url     : chr "https://api.github.com/repos/gaborcsardi/after/statuses/{sha}"
#>  $ languages_url    : chr "https://api.github.com/repos/gaborcsardi/after/languages"
#>  $ stargazers_url   : chr "https://api.github.com/repos/gaborcsardi/after/stargazers"
#>  $ contributors_url : chr "https://api.github.com/repos/gaborcsardi/after/contributors"
#>  $ subscribers_url  : chr "https://api.github.com/repos/gaborcsardi/after/subscribers"
#>  $ subscription_url : chr "https://api.github.com/repos/gaborcsardi/after/subscription"
#>  $ commits_url      : chr "https://api.github.com/repos/gaborcsardi/after/commits{/sha}"
#>  $ git_commits_url  : chr "https://api.github.com/repos/gaborcsardi/after/git/commits{/sha}"
#>  $ comments_url     : chr "https://api.github.com/repos/gaborcsardi/after/comments{/number}"
#>  $ issue_comment_url: chr "https://api.github.com/repos/gaborcsardi/after/issues/comments{/number}"
#>  $ contents_url     : chr "https://api.github.com/repos/gaborcsardi/after/contents/{+path}"
#>  $ compare_url      : chr "https://api.github.com/repos/gaborcsardi/after/compare/{base}...{head}"
#>  $ merges_url       : chr "https://api.github.com/repos/gaborcsardi/after/merges"
#>  $ archive_url      : chr "https://api.github.com/repos/gaborcsardi/after/{archive_format}{/ref}"
#>  $ downloads_url    : chr "https://api.github.com/repos/gaborcsardi/after/downloads"
#>  $ issues_url       : chr "https://api.github.com/repos/gaborcsardi/after/issues{/number}"
#>  $ pulls_url        : chr "https://api.github.com/repos/gaborcsardi/after/pulls{/number}"
#>  $ milestones_url   : chr "https://api.github.com/repos/gaborcsardi/after/milestones{/number}"
#>  $ notifications_url: chr "https://api.github.com/repos/gaborcsardi/after/notifications{?since,all,participating}"
#>  $ labels_url       : chr "https://api.github.com/repos/gaborcsardi/after/labels{/name}"
#>  $ releases_url     : chr "https://api.github.com/repos/gaborcsardi/after/releases{/id}"
#>  $ deployments_url  : chr "https://api.github.com/repos/gaborcsardi/after/deployments"
#>  $ created_at       : chr "2016-06-14T22:33:49Z"
#>  $ updated_at       : chr "2016-07-21T17:42:35Z"
#>  $ pushed_at        : chr "2016-07-09T16:13:42Z"
#>  $ git_url          : chr "git://github.com/gaborcsardi/after.git"
#>  $ ssh_url          : chr "git@github.com:gaborcsardi/after.git"
#>  $ clone_url        : chr "https://github.com/gaborcsardi/after.git"
#>  $ svn_url          : chr "https://github.com/gaborcsardi/after"
#>  $ homepage         : NULL
#>  $ size             : int 15
#>  $ stargazers_count : int 5
#>  $ watchers_count   : int 5
#>  $ language         : chr "R"
#>  $ has_issues       : logi TRUE
#>  $ has_downloads    : logi TRUE
#>  $ has_wiki         : logi TRUE
#>  $ has_pages        : logi FALSE
#>  $ forks_count      : int 0
#>  $ mirror_url       : NULL
#>  $ open_issues_count: int 0
#>  $ forks            : int 0
#>  $ open_issues      : int 0
#>  $ watchers         : int 5
#>  $ default_branch   : chr "master"
```

The output is long, but informative! If you study this for a little bit, you should realise that we have a bunch of information about a single GitHub repository (`gaborcsard/after`).

Flatten
-------

Our hypothesis then is that we have an array of arrays of objects, where each object contains information about a GitHub repository. We can check this hypothesis by spelunking around the list a little more.

``` r
str(gh_repos[[1]][[2]])
#> List of 68
#>  $ id               : int 40500181
#>  $ name             : chr "argufy"
#>  $ full_name        : chr "gaborcsardi/argufy"
#>  $ owner            :List of 17
#>   ..$ login              : chr "gaborcsardi"
#>   ..$ id                 : int 660288
#>   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/660288?v=3"
#>   ..$ gravatar_id        : chr ""
#>   ..$ url                : chr "https://api.github.com/users/gaborcsardi"
#>   ..$ html_url           : chr "https://github.com/gaborcsardi"
#>   ..$ followers_url      : chr "https://api.github.com/users/gaborcsardi/followers"
#>   ..$ following_url      : chr "https://api.github.com/users/gaborcsardi/following{/other_user}"
#>   ..$ gists_url          : chr "https://api.github.com/users/gaborcsardi/gists{/gist_id}"
#>   ..$ starred_url        : chr "https://api.github.com/users/gaborcsardi/starred{/owner}{/repo}"
#>   ..$ subscriptions_url  : chr "https://api.github.com/users/gaborcsardi/subscriptions"
#>   ..$ organizations_url  : chr "https://api.github.com/users/gaborcsardi/orgs"
#>   ..$ repos_url          : chr "https://api.github.com/users/gaborcsardi/repos"
#>   ..$ events_url         : chr "https://api.github.com/users/gaborcsardi/events{/privacy}"
#>   ..$ received_events_url: chr "https://api.github.com/users/gaborcsardi/received_events"
#>   ..$ type               : chr "User"
#>   ..$ site_admin         : logi FALSE
#>  $ private          : logi FALSE
#>  $ html_url         : chr "https://github.com/gaborcsardi/argufy"
#>  $ description      : chr "Declarative function argument checks"
#>  $ fork             : logi FALSE
#>  $ url              : chr "https://api.github.com/repos/gaborcsardi/argufy"
#>  $ forks_url        : chr "https://api.github.com/repos/gaborcsardi/argufy/forks"
#>  $ keys_url         : chr "https://api.github.com/repos/gaborcsardi/argufy/keys{/key_id}"
#>  $ collaborators_url: chr "https://api.github.com/repos/gaborcsardi/argufy/collaborators{/collaborator}"
#>  $ teams_url        : chr "https://api.github.com/repos/gaborcsardi/argufy/teams"
#>  $ hooks_url        : chr "https://api.github.com/repos/gaborcsardi/argufy/hooks"
#>  $ issue_events_url : chr "https://api.github.com/repos/gaborcsardi/argufy/issues/events{/number}"
#>  $ events_url       : chr "https://api.github.com/repos/gaborcsardi/argufy/events"
#>  $ assignees_url    : chr "https://api.github.com/repos/gaborcsardi/argufy/assignees{/user}"
#>  $ branches_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/branches{/branch}"
#>  $ tags_url         : chr "https://api.github.com/repos/gaborcsardi/argufy/tags"
#>  $ blobs_url        : chr "https://api.github.com/repos/gaborcsardi/argufy/git/blobs{/sha}"
#>  $ git_tags_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/git/tags{/sha}"
#>  $ git_refs_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/git/refs{/sha}"
#>  $ trees_url        : chr "https://api.github.com/repos/gaborcsardi/argufy/git/trees{/sha}"
#>  $ statuses_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/statuses/{sha}"
#>  $ languages_url    : chr "https://api.github.com/repos/gaborcsardi/argufy/languages"
#>  $ stargazers_url   : chr "https://api.github.com/repos/gaborcsardi/argufy/stargazers"
#>  $ contributors_url : chr "https://api.github.com/repos/gaborcsardi/argufy/contributors"
#>  $ subscribers_url  : chr "https://api.github.com/repos/gaborcsardi/argufy/subscribers"
#>  $ subscription_url : chr "https://api.github.com/repos/gaborcsardi/argufy/subscription"
#>  $ commits_url      : chr "https://api.github.com/repos/gaborcsardi/argufy/commits{/sha}"
#>  $ git_commits_url  : chr "https://api.github.com/repos/gaborcsardi/argufy/git/commits{/sha}"
#>  $ comments_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/comments{/number}"
#>  $ issue_comment_url: chr "https://api.github.com/repos/gaborcsardi/argufy/issues/comments{/number}"
#>  $ contents_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/contents/{+path}"
#>  $ compare_url      : chr "https://api.github.com/repos/gaborcsardi/argufy/compare/{base}...{head}"
#>  $ merges_url       : chr "https://api.github.com/repos/gaborcsardi/argufy/merges"
#>  $ archive_url      : chr "https://api.github.com/repos/gaborcsardi/argufy/{archive_format}{/ref}"
#>  $ downloads_url    : chr "https://api.github.com/repos/gaborcsardi/argufy/downloads"
#>  $ issues_url       : chr "https://api.github.com/repos/gaborcsardi/argufy/issues{/number}"
#>  $ pulls_url        : chr "https://api.github.com/repos/gaborcsardi/argufy/pulls{/number}"
#>  $ milestones_url   : chr "https://api.github.com/repos/gaborcsardi/argufy/milestones{/number}"
#>  $ notifications_url: chr "https://api.github.com/repos/gaborcsardi/argufy/notifications{?since,all,participating}"
#>  $ labels_url       : chr "https://api.github.com/repos/gaborcsardi/argufy/labels{/name}"
#>  $ releases_url     : chr "https://api.github.com/repos/gaborcsardi/argufy/releases{/id}"
#>  $ deployments_url  : chr "https://api.github.com/repos/gaborcsardi/argufy/deployments"
#>  $ created_at       : chr "2015-08-10T18:56:23Z"
#>  $ updated_at       : chr "2016-06-30T18:28:08Z"
#>  $ pushed_at        : chr "2016-03-12T14:59:25Z"
#>  $ git_url          : chr "git://github.com/gaborcsardi/argufy.git"
#>  $ ssh_url          : chr "git@github.com:gaborcsardi/argufy.git"
#>  $ clone_url        : chr "https://github.com/gaborcsardi/argufy.git"
#>  $ svn_url          : chr "https://github.com/gaborcsardi/argufy"
#>  $ homepage         : NULL
#>  $ size             : int 115
#>  $ stargazers_count : int 19
#>  $ watchers_count   : int 19
#>  $ language         : chr "R"
#>  $ has_issues       : logi TRUE
#>  $ has_downloads    : logi TRUE
#>  $ has_wiki         : logi TRUE
#>  $ has_pages        : logi FALSE
#>  $ forks_count      : int 1
#>  $ mirror_url       : NULL
#>  $ open_issues_count: int 6
#>  $ forks            : int 1
#>  $ open_issues      : int 6
#>  $ watchers         : int 19
#>  $ default_branch   : chr "master"
str(gh_repos[[2]][[2]])
#> List of 68
#>  $ id               : int 14152301
#>  $ name             : chr "2014-01-27-miami"
#>  $ full_name        : chr "jennybc/2014-01-27-miami"
#>  $ owner            :List of 17
#>   ..$ login              : chr "jennybc"
#>   ..$ id                 : int 599454
#>   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/599454?v=3"
#>   ..$ gravatar_id        : chr ""
#>   ..$ url                : chr "https://api.github.com/users/jennybc"
#>   ..$ html_url           : chr "https://github.com/jennybc"
#>   ..$ followers_url      : chr "https://api.github.com/users/jennybc/followers"
#>   ..$ following_url      : chr "https://api.github.com/users/jennybc/following{/other_user}"
#>   ..$ gists_url          : chr "https://api.github.com/users/jennybc/gists{/gist_id}"
#>   ..$ starred_url        : chr "https://api.github.com/users/jennybc/starred{/owner}{/repo}"
#>   ..$ subscriptions_url  : chr "https://api.github.com/users/jennybc/subscriptions"
#>   ..$ organizations_url  : chr "https://api.github.com/users/jennybc/orgs"
#>   ..$ repos_url          : chr "https://api.github.com/users/jennybc/repos"
#>   ..$ events_url         : chr "https://api.github.com/users/jennybc/events{/privacy}"
#>   ..$ received_events_url: chr "https://api.github.com/users/jennybc/received_events"
#>   ..$ type               : chr "User"
#>   ..$ site_admin         : logi FALSE
#>  $ private          : logi FALSE
#>  $ html_url         : chr "https://github.com/jennybc/2014-01-27-miami"
#>  $ description      : chr "Software Carpentry Bootcamp at the University of Miami"
#>  $ fork             : logi FALSE
#>  $ url              : chr "https://api.github.com/repos/jennybc/2014-01-27-miami"
#>  $ forks_url        : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/forks"
#>  $ keys_url         : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/keys{/key_id}"
#>  $ collaborators_url: chr "https://api.github.com/repos/jennybc/2014-01-27-miami/collaborators{/collaborator}"
#>  $ teams_url        : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/teams"
#>  $ hooks_url        : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/hooks"
#>  $ issue_events_url : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/issues/events{/number}"
#>  $ events_url       : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/events"
#>  $ assignees_url    : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/assignees{/user}"
#>  $ branches_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/branches{/branch}"
#>  $ tags_url         : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/tags"
#>  $ blobs_url        : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/git/blobs{/sha}"
#>  $ git_tags_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/git/tags{/sha}"
#>  $ git_refs_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/git/refs{/sha}"
#>  $ trees_url        : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/git/trees{/sha}"
#>  $ statuses_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/statuses/{sha}"
#>  $ languages_url    : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/languages"
#>  $ stargazers_url   : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/stargazers"
#>  $ contributors_url : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/contributors"
#>  $ subscribers_url  : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/subscribers"
#>  $ subscription_url : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/subscription"
#>  $ commits_url      : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/commits{/sha}"
#>  $ git_commits_url  : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/git/commits{/sha}"
#>  $ comments_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/comments{/number}"
#>  $ issue_comment_url: chr "https://api.github.com/repos/jennybc/2014-01-27-miami/issues/comments{/number}"
#>  $ contents_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/contents/{+path}"
#>  $ compare_url      : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/compare/{base}...{head}"
#>  $ merges_url       : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/merges"
#>  $ archive_url      : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/{archive_format}{/ref}"
#>  $ downloads_url    : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/downloads"
#>  $ issues_url       : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/issues{/number}"
#>  $ pulls_url        : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/pulls{/number}"
#>  $ milestones_url   : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/milestones{/number}"
#>  $ notifications_url: chr "https://api.github.com/repos/jennybc/2014-01-27-miami/notifications{?since,all,participating}"
#>  $ labels_url       : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/labels{/name}"
#>  $ releases_url     : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/releases{/id}"
#>  $ deployments_url  : chr "https://api.github.com/repos/jennybc/2014-01-27-miami/deployments"
#>  $ created_at       : chr "2013-11-05T19:55:23Z"
#>  $ updated_at       : chr "2014-06-02T08:52:46Z"
#>  $ pushed_at        : chr "2014-01-28T07:01:26Z"
#>  $ git_url          : chr "git://github.com/jennybc/2014-01-27-miami.git"
#>  $ ssh_url          : chr "git@github.com:jennybc/2014-01-27-miami.git"
#>  $ clone_url        : chr "https://github.com/jennybc/2014-01-27-miami.git"
#>  $ svn_url          : chr "https://github.com/jennybc/2014-01-27-miami"
#>  $ homepage         : NULL
#>  $ size             : int 16662
#>  $ stargazers_count : int 1
#>  $ watchers_count   : int 1
#>  $ language         : chr "Python"
#>  $ has_issues       : logi TRUE
#>  $ has_downloads    : logi TRUE
#>  $ has_wiki         : logi TRUE
#>  $ has_pages        : logi TRUE
#>  $ forks_count      : int 6
#>  $ mirror_url       : NULL
#>  $ open_issues_count: int 4
#>  $ forks            : int 6
#>  $ open_issues      : int 4
#>  $ watchers         : int 1
#>  $ default_branch   : chr "gh-pages"
str(gh_repos[[6]][[30]])
#> List of 68
#>  $ id               : int 54576272
#>  $ name             : chr "youtubedata"
#>  $ full_name        : chr "masalmon/youtubedata"
#>  $ owner            :List of 17
#>   ..$ login              : chr "masalmon"
#>   ..$ id                 : int 8360597
#>   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/8360597?v=3"
#>   ..$ gravatar_id        : chr ""
#>   ..$ url                : chr "https://api.github.com/users/masalmon"
#>   ..$ html_url           : chr "https://github.com/masalmon"
#>   ..$ followers_url      : chr "https://api.github.com/users/masalmon/followers"
#>   ..$ following_url      : chr "https://api.github.com/users/masalmon/following{/other_user}"
#>   ..$ gists_url          : chr "https://api.github.com/users/masalmon/gists{/gist_id}"
#>   ..$ starred_url        : chr "https://api.github.com/users/masalmon/starred{/owner}{/repo}"
#>   ..$ subscriptions_url  : chr "https://api.github.com/users/masalmon/subscriptions"
#>   ..$ organizations_url  : chr "https://api.github.com/users/masalmon/orgs"
#>   ..$ repos_url          : chr "https://api.github.com/users/masalmon/repos"
#>   ..$ events_url         : chr "https://api.github.com/users/masalmon/events{/privacy}"
#>   ..$ received_events_url: chr "https://api.github.com/users/masalmon/received_events"
#>   ..$ type               : chr "User"
#>   ..$ site_admin         : logi FALSE
#>  $ private          : logi FALSE
#>  $ html_url         : chr "https://github.com/masalmon/youtubedata"
#>  $ description      : NULL
#>  $ fork             : logi FALSE
#>  $ url              : chr "https://api.github.com/repos/masalmon/youtubedata"
#>  $ forks_url        : chr "https://api.github.com/repos/masalmon/youtubedata/forks"
#>  $ keys_url         : chr "https://api.github.com/repos/masalmon/youtubedata/keys{/key_id}"
#>  $ collaborators_url: chr "https://api.github.com/repos/masalmon/youtubedata/collaborators{/collaborator}"
#>  $ teams_url        : chr "https://api.github.com/repos/masalmon/youtubedata/teams"
#>  $ hooks_url        : chr "https://api.github.com/repos/masalmon/youtubedata/hooks"
#>  $ issue_events_url : chr "https://api.github.com/repos/masalmon/youtubedata/issues/events{/number}"
#>  $ events_url       : chr "https://api.github.com/repos/masalmon/youtubedata/events"
#>  $ assignees_url    : chr "https://api.github.com/repos/masalmon/youtubedata/assignees{/user}"
#>  $ branches_url     : chr "https://api.github.com/repos/masalmon/youtubedata/branches{/branch}"
#>  $ tags_url         : chr "https://api.github.com/repos/masalmon/youtubedata/tags"
#>  $ blobs_url        : chr "https://api.github.com/repos/masalmon/youtubedata/git/blobs{/sha}"
#>  $ git_tags_url     : chr "https://api.github.com/repos/masalmon/youtubedata/git/tags{/sha}"
#>  $ git_refs_url     : chr "https://api.github.com/repos/masalmon/youtubedata/git/refs{/sha}"
#>  $ trees_url        : chr "https://api.github.com/repos/masalmon/youtubedata/git/trees{/sha}"
#>  $ statuses_url     : chr "https://api.github.com/repos/masalmon/youtubedata/statuses/{sha}"
#>  $ languages_url    : chr "https://api.github.com/repos/masalmon/youtubedata/languages"
#>  $ stargazers_url   : chr "https://api.github.com/repos/masalmon/youtubedata/stargazers"
#>  $ contributors_url : chr "https://api.github.com/repos/masalmon/youtubedata/contributors"
#>  $ subscribers_url  : chr "https://api.github.com/repos/masalmon/youtubedata/subscribers"
#>  $ subscription_url : chr "https://api.github.com/repos/masalmon/youtubedata/subscription"
#>  $ commits_url      : chr "https://api.github.com/repos/masalmon/youtubedata/commits{/sha}"
#>  $ git_commits_url  : chr "https://api.github.com/repos/masalmon/youtubedata/git/commits{/sha}"
#>  $ comments_url     : chr "https://api.github.com/repos/masalmon/youtubedata/comments{/number}"
#>  $ issue_comment_url: chr "https://api.github.com/repos/masalmon/youtubedata/issues/comments{/number}"
#>  $ contents_url     : chr "https://api.github.com/repos/masalmon/youtubedata/contents/{+path}"
#>  $ compare_url      : chr "https://api.github.com/repos/masalmon/youtubedata/compare/{base}...{head}"
#>  $ merges_url       : chr "https://api.github.com/repos/masalmon/youtubedata/merges"
#>  $ archive_url      : chr "https://api.github.com/repos/masalmon/youtubedata/{archive_format}{/ref}"
#>  $ downloads_url    : chr "https://api.github.com/repos/masalmon/youtubedata/downloads"
#>  $ issues_url       : chr "https://api.github.com/repos/masalmon/youtubedata/issues{/number}"
#>  $ pulls_url        : chr "https://api.github.com/repos/masalmon/youtubedata/pulls{/number}"
#>  $ milestones_url   : chr "https://api.github.com/repos/masalmon/youtubedata/milestones{/number}"
#>  $ notifications_url: chr "https://api.github.com/repos/masalmon/youtubedata/notifications{?since,all,participating}"
#>  $ labels_url       : chr "https://api.github.com/repos/masalmon/youtubedata/labels{/name}"
#>  $ releases_url     : chr "https://api.github.com/repos/masalmon/youtubedata/releases{/id}"
#>  $ deployments_url  : chr "https://api.github.com/repos/masalmon/youtubedata/deployments"
#>  $ created_at       : chr "2016-03-23T16:35:56Z"
#>  $ updated_at       : chr "2016-03-23T16:36:40Z"
#>  $ pushed_at        : chr "2016-03-23T16:43:46Z"
#>  $ git_url          : chr "git://github.com/masalmon/youtubedata.git"
#>  $ ssh_url          : chr "git@github.com:masalmon/youtubedata.git"
#>  $ clone_url        : chr "https://github.com/masalmon/youtubedata.git"
#>  $ svn_url          : chr "https://github.com/masalmon/youtubedata"
#>  $ homepage         : NULL
#>  $ size             : int 75
#>  $ stargazers_count : int 0
#>  $ watchers_count   : int 0
#>  $ language         : chr "R"
#>  $ has_issues       : logi TRUE
#>  $ has_downloads    : logi TRUE
#>  $ has_wiki         : logi TRUE
#>  $ has_pages        : logi FALSE
#>  $ forks_count      : int 0
#>  $ mirror_url       : NULL
#>  $ open_issues_count: int 0
#>  $ forks            : int 0
#>  $ open_issues      : int 0
#>  $ watchers         : int 0
#>  $ default_branch   : chr "master"
```

In other words, `gh_repos[[1]]` is a list of GitHub repos (which is also a list). And so is `gh_repos[[2]]`, `gh_repos[[3]]`, ..., all the way up to `gh_repos[[6]]`. This is a fairly common data structure: there is so much information about each repo that they've been broken up into pages. We have 6 pages (`length(gh_commit))`. How many repos are there in total? We need to fund the length of each sub-list, and sum them up:

``` r
gh_repos %>% map_int(length) %>% sum()
#> [1] 176
```

This nesting is annoying and doesn't contain any useful informative so I'm going to get rid of it with `flatten()`. This flattens a list of lists into a list. There were 176 sublists before so now we get a list of length 176.

``` r
gh_flat <- gh_repos %>% flatten()
length(gh_flat)
#> [1] 176
```

Rectangle
---------

Imagine we want to collapse some of this information into a tibble. For the sake of this example, lets say we want:

-   the name of the repo
-   the number of open issues
-   if it has a wiki
-   the homepage
-   the owner's GitHub name

To extract each of these variables we need to use a map function. The first three are easy: you just need to identify the name of the component and its type.

``` r
first10 <- gh_flat %>% head(10)

first10 %>% map_chr("name")
#>  [1] "after"       "argufy"      "ask"         "baseimports" "citest"     
#>  [6] "clisymbols"  "cmaker"      "cmark"       "conditions"  "crayon"
first10 %>% map_int("open_issues_count")
#>  [1] 0 6 4 0 0 0 0 0 0 7
first10 %>% map_lgl("has_wiki")
#>  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
```

The homepage is a little trickier:

``` r
first10 %>% map_chr("homepage")
#> Error: Result 1 is not a length 1 atomic vector
```

Whenever you see this error, you've got two options to dig into it. Either switch to `map()` or find the specific value that's a problem. Here that's position 1.

``` r
first10[[1]]$"homepage"
#> NULL
first10 %>% map("homepage")
#> [[1]]
#> NULL
#> 
#> [[2]]
#> NULL
#> 
#> [[3]]
#> NULL
#> 
#> [[4]]
#> NULL
#> 
#> [[5]]
#> NULL
#> 
#> [[6]]
#> [1] ""
#> 
#> [[7]]
#> NULL
#> 
#> [[8]]
#> NULL
#> 
#> [[9]]
#> NULL
#> 
#> [[10]]
#> NULL
```

It looks like most of these are missing a homepage. JSON doesn't have missing values, so instead of an `NA`, we get a `NULL`. purrr map functions provide an easy way to turn these into something useful: you can supply a `.default` value. Here I'm going to use `""` since it looks like some repos get that value. Finding the right value here is a matter of trial and error.

``` r
first10 %>% map_chr("homepage", .default = "")
#>  [1] "" "" "" "" "" "" "" "" "" ""
```

(None of the first 10 repos have homepages but later ones do)

Getting the owner's repo name is a little trickier because it doesn't live at the top-level; it lives one level down. Fortunately you can supply a character vector to the map functions:

``` r
first10 %>% map_chr(c("owner", "login"))
#>  [1] "gaborcsardi" "gaborcsardi" "gaborcsardi" "gaborcsardi" "gaborcsardi"
#>  [6] "gaborcsardi" "gaborcsardi" "gaborcsardi" "gaborcsardi" "gaborcsardi"
```

We can put all these bits together to make a tibble:

``` r
gh_tibble <- tibble(
  name =     gh_flat %>% map_chr("name"),
  issues =   gh_flat %>% map_int("open_issues_count"),
  wiki =     gh_flat %>% map_lgl("has_wiki"),
  homepage = gh_flat %>% map_chr("homepage", .default = ""),
  owner =    gh_flat %>% map_chr(c("owner", "login"))
)
gh_tibble
#> # A tibble: 176 × 5
#>           name issues  wiki homepage       owner
#>          <chr>  <int> <lgl>    <chr>       <chr>
#>  1       after      0  TRUE          gaborcsardi
#>  2      argufy      6  TRUE          gaborcsardi
#>  3         ask      4  TRUE          gaborcsardi
#>  4 baseimports      0  TRUE          gaborcsardi
#>  5      citest      0  TRUE          gaborcsardi
#>  6  clisymbols      0  TRUE          gaborcsardi
#>  7      cmaker      0  TRUE          gaborcsardi
#>  8       cmark      0  TRUE          gaborcsardi
#>  9  conditions      0  TRUE          gaborcsardi
#> 10      crayon      7  TRUE          gaborcsardi
#> # ... with 166 more rows
```

Our rectangling is complete!

