title: Data rectangling
theme: explore
needs: list-cols
readings: ~
desc: "\nData rectangling is the process of turning non-rectangular data (like JSON/hierarchical
  lists) into tidy tibbles. The term was [coined by](https://speakerdeck.com/jennybc/data-rectangling)
  by [Jenny Bryan](https://www.stat.ubc.ca/~jenny/).\n\n``` r\nlibrary(jsonlite)\nlibrary(tidyverse)\n```\n\nWe're
  also going to use some data from Jenny's repurrrsive package, which you'll need
  to install from GitHub:\n\n``` r\n# install.packages(\"devtools\")\ndevtools::install_github(\"jennybc/repurrrsive\")\n```\n\n```
  r\nlibrary(repurrrsive)\n```\n\nInspect\n-------\n\nWe're going to work with data
  about GitHub repositories stored in `repurrrsive::github_repos`, which comes from
  [An API of Ice and Fire](https://anapioficeandfire.com). The first challenge you
  need to surmount when working with this sort of data is that it's suprisingly hard
  to look at.\n\nOne option, if you're willing to live (a litte) dangerously, is to
  use a [daily build](https://dailies.rstudio.com) of RStudio which has a good interactive
  explorer that you can activate with:\n\n``` r\nView(github_repos)\n```\n\n`str()`
  is not usually helpful because it prints too much. It's so useless here that I'm
  not going to show it, but I recommend you run locally just so you understand what
  I'm talking about.\n\nInstead, a useful general technique is to peel it apart and
  look at a single piece. To do that you need to first figure out if you should index
  by name or position:\n\n``` r\nnames(gh_repos)\n#> NULL\nlength(gh_repos)\n#> [1]
  6\n```\n\nHere names is `NULL`, so we should index by position:\n\n``` r\none <-
  gh_repos[[1]]\nnames(one)\n#> NULL\nlength(one)\n#> [1] 30\n```\n\nAnd `names()`
  is still null so we also need to index this layer by position:\n\n``` r\none_one
  <- one[[1]]\nnames(one_one)\n#>  [1] \"id\"                \"name\"              \"full_name\"
  \       \n#>  [4] \"owner\"             \"private\"           \"html_url\"         \n#>
  \ [7] \"description\"       \"fork\"              \"url\"              \n#> [10]
  \"forks_url\"         \"keys_url\"          \"collaborators_url\"\n#> [13] \"teams_url\"
  \        \"hooks_url\"         \"issue_events_url\" \n#> [16] \"events_url\"        \"assignees_url\"
  \    \"branches_url\"     \n#> [19] \"tags_url\"          \"blobs_url\"         \"git_tags_url\"
  \    \n#> [22] \"git_refs_url\"      \"trees_url\"         \"statuses_url\"     \n#>
  [25] \"languages_url\"     \"stargazers_url\"    \"contributors_url\" \n#> [28]
  \"subscribers_url\"   \"subscription_url\"  \"commits_url\"      \n#> [31] \"git_commits_url\"
  \  \"comments_url\"      \"issue_comment_url\"\n#> [34] \"contents_url\"      \"compare_url\"
  \      \"merges_url\"       \n#> [37] \"archive_url\"       \"downloads_url\"     \"issues_url\"
  \      \n#> [40] \"pulls_url\"         \"milestones_url\"    \"notifications_url\"\n#>
  [43] \"labels_url\"        \"releases_url\"      \"deployments_url\"  \n#> [46]
  \"created_at\"        \"updated_at\"        \"pushed_at\"        \n#> [49] \"git_url\"
  \          \"ssh_url\"           \"clone_url\"        \n#> [52] \"svn_url\"           \"homepage\"
  \         \"size\"             \n#> [55] \"stargazers_count\"  \"watchers_count\"
  \   \"language\"         \n#> [58] \"has_issues\"        \"has_downloads\"     \"has_wiki\"
  \        \n#> [61] \"has_pages\"         \"forks_count\"       \"mirror_url\"       \n#>
  [64] \"open_issues_count\" \"forks\"             \"open_issues\"      \n#> [67]
  \"watchers\"          \"default_branch\"\n```\n\nPhew! We finally got some names
  so we can set what's going on. Once you get to a level with names, it's often far
  enough down that `str()` is useful again. It's long but helpful here:\n\n``` r\nstr(one_one)\n#>
  List of 68\n#>  $ id               : int 61160198\n#>  $ name             : chr
  \"after\"\n#>  $ full_name        : chr \"gaborcsardi/after\"\n#>  $ owner            :List
  of 17\n#>   ..$ login              : chr \"gaborcsardi\"\n#>   ..$ id                 :
  int 660288\n#>   ..$ avatar_url         : chr \"https://avatars.githubusercontent.com/u/660288?v=3\"\n#>
  \  ..$ gravatar_id        : chr \"\"\n#>   ..$ url                : chr \"https://api.github.com/users/gaborcsardi\"\n#>
  \  ..$ html_url           : chr \"https://github.com/gaborcsardi\"\n#>   ..$ followers_url
  \     : chr \"https://api.github.com/users/gaborcsardi/followers\"\n#>   ..$ following_url
  \     : chr \"https://api.github.com/users/gaborcsardi/following{/other_user}\"\n#>
  \  ..$ gists_url          : chr \"https://api.github.com/users/gaborcsardi/gists{/gist_id}\"\n#>
  \  ..$ starred_url        : chr \"https://api.github.com/users/gaborcsardi/starred{/owner}{/repo}\"\n#>
  \  ..$ subscriptions_url  : chr \"https://api.github.com/users/gaborcsardi/subscriptions\"\n#>
  \  ..$ organizations_url  : chr \"https://api.github.com/users/gaborcsardi/orgs\"\n#>
  \  ..$ repos_url          : chr \"https://api.github.com/users/gaborcsardi/repos\"\n#>
  \  ..$ events_url         : chr \"https://api.github.com/users/gaborcsardi/events{/privacy}\"\n#>
  \  ..$ received_events_url: chr \"https://api.github.com/users/gaborcsardi/received_events\"\n#>
  \  ..$ type               : chr \"User\"\n#>   ..$ site_admin         : logi FALSE\n#>
  \ $ private          : logi FALSE\n#>  $ html_url         : chr \"https://github.com/gaborcsardi/after\"\n#>
  \ $ description      : chr \"Run Code in the Background\"\n#>  $ fork             :
  logi FALSE\n#>  $ url              : chr \"https://api.github.com/repos/gaborcsardi/after\"\n#>
  \ $ forks_url        : chr \"https://api.github.com/repos/gaborcsardi/after/forks\"\n#>
  \ $ keys_url         : chr \"https://api.github.com/repos/gaborcsardi/after/keys{/key_id}\"\n#>
  \ $ collaborators_url: chr \"https://api.github.com/repos/gaborcsardi/after/collaborators{/collaborator}\"\n#>
  \ $ teams_url        : chr \"https://api.github.com/repos/gaborcsardi/after/teams\"\n#>
  \ $ hooks_url        : chr \"https://api.github.com/repos/gaborcsardi/after/hooks\"\n#>
  \ $ issue_events_url : chr \"https://api.github.com/repos/gaborcsardi/after/issues/events{/number}\"\n#>
  \ $ events_url       : chr \"https://api.github.com/repos/gaborcsardi/after/events\"\n#>
  \ $ assignees_url    : chr \"https://api.github.com/repos/gaborcsardi/after/assignees{/user}\"\n#>
  \ $ branches_url     : chr \"https://api.github.com/repos/gaborcsardi/after/branches{/branch}\"\n#>
  \ $ tags_url         : chr \"https://api.github.com/repos/gaborcsardi/after/tags\"\n#>
  \ $ blobs_url        : chr \"https://api.github.com/repos/gaborcsardi/after/git/blobs{/sha}\"\n#>
  \ $ git_tags_url     : chr \"https://api.github.com/repos/gaborcsardi/after/git/tags{/sha}\"\n#>
  \ $ git_refs_url     : chr \"https://api.github.com/repos/gaborcsardi/after/git/refs{/sha}\"\n#>
  \ $ trees_url        : chr \"https://api.github.com/repos/gaborcsardi/after/git/trees{/sha}\"\n#>
  \ $ statuses_url     : chr \"https://api.github.com/repos/gaborcsardi/after/statuses/{sha}\"\n#>
  \ $ languages_url    : chr \"https://api.github.com/repos/gaborcsardi/after/languages\"\n#>
  \ $ stargazers_url   : chr \"https://api.github.com/repos/gaborcsardi/after/stargazers\"\n#>
  \ $ contributors_url : chr \"https://api.github.com/repos/gaborcsardi/after/contributors\"\n#>
  \ $ subscribers_url  : chr \"https://api.github.com/repos/gaborcsardi/after/subscribers\"\n#>
  \ $ subscription_url : chr \"https://api.github.com/repos/gaborcsardi/after/subscription\"\n#>
  \ $ commits_url      : chr \"https://api.github.com/repos/gaborcsardi/after/commits{/sha}\"\n#>
  \ $ git_commits_url  : chr \"https://api.github.com/repos/gaborcsardi/after/git/commits{/sha}\"\n#>
  \ $ comments_url     : chr \"https://api.github.com/repos/gaborcsardi/after/comments{/number}\"\n#>
  \ $ issue_comment_url: chr \"https://api.github.com/repos/gaborcsardi/after/issues/comments{/number}\"\n#>
  \ $ contents_url     : chr \"https://api.github.com/repos/gaborcsardi/after/contents/{+path}\"\n#>
  \ $ compare_url      : chr \"https://api.github.com/repos/gaborcsardi/after/compare/{base}...{head}\"\n#>
  \ $ merges_url       : chr \"https://api.github.com/repos/gaborcsardi/after/merges\"\n#>
  \ $ archive_url      : chr \"https://api.github.com/repos/gaborcsardi/after/{archive_format}{/ref}\"\n#>
  \ $ downloads_url    : chr \"https://api.github.com/repos/gaborcsardi/after/downloads\"\n#>
  \ $ issues_url       : chr \"https://api.github.com/repos/gaborcsardi/after/issues{/number}\"\n#>
  \ $ pulls_url        : chr \"https://api.github.com/repos/gaborcsardi/after/pulls{/number}\"\n#>
  \ $ milestones_url   : chr \"https://api.github.com/repos/gaborcsardi/after/milestones{/number}\"\n#>
  \ $ notifications_url: chr \"https://api.github.com/repos/gaborcsardi/after/notifications{?since,all,participating}\"\n#>
  \ $ labels_url       : chr \"https://api.github.com/repos/gaborcsardi/after/labels{/name}\"\n#>
  \ $ releases_url     : chr \"https://api.github.com/repos/gaborcsardi/after/releases{/id}\"\n#>
  \ $ deployments_url  : chr \"https://api.github.com/repos/gaborcsardi/after/deployments\"\n#>
  \ $ created_at       : chr \"2016-06-14T22:33:49Z\"\n#>  $ updated_at       : chr
  \"2016-07-21T17:42:35Z\"\n#>  $ pushed_at        : chr \"2016-07-09T16:13:42Z\"\n#>
  \ $ git_url          : chr \"git://github.com/gaborcsardi/after.git\"\n#>  $ ssh_url
  \         : chr \"git@github.com:gaborcsardi/after.git\"\n#>  $ clone_url        :
  chr \"https://github.com/gaborcsardi/after.git\"\n#>  $ svn_url          : chr \"https://github.com/gaborcsardi/after\"\n#>
  \ $ homepage         : NULL\n#>  $ size             : int 15\n#>  $ stargazers_count
  : int 5\n#>  $ watchers_count   : int 5\n#>  $ language         : chr \"R\"\n#>
  \ $ has_issues       : logi TRUE\n#>  $ has_downloads    : logi TRUE\n#>  $ has_wiki
  \        : logi TRUE\n#>  $ has_pages        : logi FALSE\n#>  $ forks_count      :
  int 0\n#>  $ mirror_url       : NULL\n#>  $ open_issues_count: int 0\n#>  $ forks
  \           : int 0\n#>  $ open_issues      : int 0\n#>  $ watchers         : int
  5\n#>  $ default_branch   : chr \"master\"\n```\n\nSo it looks like we have a bunch
  of information about a single GitHub repository (`gaborcsard/after`). A bit more
  speluninking reveals that every element of `one` is a different GitHub repo.\n\nSo
  `gh_repos[[1]]` is a list of GitHub repos (which is also a list). So what is `gh_repos[[2]]`,
  `gh_repos[[3]]` etc? Well they're also lists of GitHub repos. This is a fairly common
  data structure: there is so much information about each repo that they've been broken
  up into pages.\n\nQuery\n-----\n\nHow many pages in total?\n\n``` r\ngh_repos %>%
  map_int(length) %>% sum()\n#> [1] 176\n```\n\nThis pagination is a bit annoying
  so I'm going to get rid of it with `flatten()`. This flattens a list of lists into
  a list. So it's now length 176.\n\n``` r\ngh_flat <- gh_repos %>% flatten()\nlength(gh_flat)\n#>
  [1] 176\n```\n\nNow we want to reduce these\n"
